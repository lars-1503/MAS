# Add Mandatory Date of Birth and Occupation Fields to User Entity

## User Story

As an administrator,
I want the user entity to include a date of birth and occupation mandatory field
So that I can store and view additional personal information about each user.

---

## Acceptance Criteria

### Scenario: New User Creation - Valid Mandatory Data
*   **Given**:
    *   I am on the user creation page
    *   Date of Birth and Occupation fields are present
*   **When**:
    *   I provide valid data for all mandatory user fields, including 'Date of Birth' (e.g., '1990-01-15') and 'Occupation' (e.g., 'Software Engineer')
    *   I submit the user creation form
*   **Then**:
    *   The new user is successfully created and stored in the system
    *   The 'Date of Birth' and 'Occupation' are correctly associated with the new user

### Scenario: New User Creation - Missing Mandatory Date of Birth
*   **Given**:
    *   I am on the user creation page
    *   Date of Birth and Occupation fields are present
*   **When**:
    *   I provide valid data for all mandatory user fields except 'Date of Birth'
    *   I submit the user creation form
*   **Then**:
    *   An error message 'Date of Birth is required' is displayed
    *   The user is not created

### Scenario: New User Creation - Missing Mandatory Occupation
*   **Given**:
    *   I am on the user creation page
    *   Date of Birth and Occupation fields are present
*   **When**:
    *   I provide valid data for all mandatory user fields except 'Occupation'
    *   I submit the user creation form
*   **Then**:
    *   An error message 'Occupation is required' is displayed
    *   The user is not created

### Scenario: New User Creation - Invalid Date of Birth Format
*   **Given**:
    *   I am on the user creation page
    *   Date of Birth field is present
    *   Occupation field is present
*   **When**:
    *   I provide an invalid format for 'Date of Birth' (e.g., 'January 15, 1990' or '15/01/1990' if YYYY-MM-DD is strict)
    *   I provide valid data for 'Occupation'
    *   I submit the user creation form
*   **Then**:
    *   An error message indicating invalid date format (e.g., 'Date of Birth must be in YYYY-MM-DD format') is displayed
    *   The user is not created

### Scenario: Editing Existing User - Adding Missing Mandatory Data
*   **Given**:
    *   An existing user exists without 'Date of Birth' and 'Occupation' populated
    *   I am on the user edit page for that user
*   **When**:
    *   I provide valid data for 'Date of Birth' (e.g., '1985-06-20') and 'Occupation' (e.g., 'Project Manager')
    *   I save the user changes
*   **Then**:
    *   The user's profile is successfully updated
    *   The 'Date of Birth' and 'Occupation' fields are now populated for the user

### Scenario: Editing Existing User - Attempting to Remove Mandatory Data
*   **Given**:
    *   An existing user exists with 'Date of Birth' and 'Occupation' populated
    *   I am on the user edit page for that user
*   **When**:
    *   I attempt to clear or remove the values from 'Date of Birth' and/or 'Occupation'
    *   I save the user changes
*   **Then**:
    *   An error message 'Date of Birth is required' and/or 'Occupation is required' is displayed
    *   The user's profile is not updated with the cleared values
    *   The 'Date of Birth' and 'Occupation' fields retain their original values

### Scenario: Viewing User Details - Displaying Mandatory Fields
*   **Given**:
    *   An existing user has 'Date of Birth' and 'Occupation' populated
*   **When**:
    *   I view the details of that user
*   **Then**:
    *   The 'Date of Birth' field is displayed with the correct date (e.g., '1990-01-15')
    *   The 'Occupation' field is displayed with the correct value (e.g., 'Software Engineer')

---

## Sub-Tasks

*   [ ] Database Schema Update: Add 'date_of_birth' (DATE, NOT NULL) and 'occupation' (VARCHAR, NOT NULL) columns to the 'users' table. Create and test migration scripts. (2 points)
*   [ ] Backend - Update User Entity/Model: Add 'dateOfBirth' (Date/LocalDate) and 'occupation' (String) fields to the User entity/model. (1 point)
*   [ ] Backend - Update DTOs/Request/Response Models: Modify API request DTOs (e.g., UserCreationRequest, UserUpdateRequest) and response DTOs (e.g., UserResponse) to include 'dateOfBirth' and 'occupation' fields. (1 point)
*   [ ] Backend - Implement Server-Side Validation: Develop validation logic for 'dateOfBirth' (mandatory, YYYY-MM-DD format) and 'occupation' (mandatory) within backend services/controllers. Implement error handling for invalid inputs. (3 points)
*   [ ] Backend - Update User Creation Endpoint: Modify the API endpoint for user creation to accept, validate, and persist 'dateOfBirth' and 'occupation' fields. (2 points)
*   [ ] Backend - Update User Update Endpoint: Modify the API endpoint for user update to accept, validate, and persist 'dateOfBirth' and 'occupation' fields. Ensure validation prevents clearing mandatory fields. (3 points)
*   [ ] Backend - Update User Retrieval Endpoint: Modify API endpoints for retrieving user details (e.g., Get User by ID, Get All Users) to include 'dateOfBirth' and 'occupation' in the response. (1 point)
*   [ ] Frontend - Implement Date of Birth Input Field: Add a Date of Birth input field (preferably a date picker component) to the user creation and user edit forms. (3 points)
*   [ ] Frontend - Implement Occupation Input Field: Add a text input field for Occupation to the user creation and user edit forms. (1 point)
*   [ ] Frontend - Implement Client-Side Validation & Error Display: Add client-side validation for 'Date of Birth' and 'Occupation' (mandatory). Display appropriate error messages for both client-side and server-side validation failures. (3 points)
*   [ ] Frontend - Update User Details View: Display 'Date of Birth' and 'Occupation' fields on the user details/profile viewing page. (1 point)
*   [ ] Automated Tests - Backend Unit & Integration Tests: Write comprehensive unit tests for validation logic and integration tests for user creation, update, and retrieval API endpoints, covering all backend acceptance criteria scenarios. (5 points)
*   [ ] Automated Tests - Frontend Unit & Component Tests: Write unit/component tests for the new Date of Birth and Occupation input fields, including their validation and display logic. (2 points)
*   [ ] Automated Tests - End-to-End (E2E) Tests: Develop E2E tests to automate all Gherkin acceptance criteria scenarios (new user creation, editing, viewing, all validation error cases). (5 points)
*   [ ] Documentation - API Documentation Update: Update OpenAPI/Swagger documentation to reflect the new 'dateOfBirth' and 'occupation' fields, their data types, and validation rules for relevant user endpoints. (2 points)
*   [ ] Documentation - Internal Documentation Update: Update relevant internal documentation (e.g., administrator guide, data dictionary) with details about the new mandatory user fields. (2 points)
*   [ ] Security Review & Implementation: Review security implications of storing Date of Birth (e.g., data sensitivity, potential encryption needs, input sanitization for both fields) and implement necessary measures. (3 points)
*   [ ] Performance Assessment: Assess the performance impact of adding new fields on database queries and API response times. Optimize if any performance degradation is identified. (2 points)

---

## Definition of Done

*   [x] Code is written, reviewed, and adheres to coding standards.
*   [x] Unit tests are written and pass with acceptable coverage (e.g., >80%).
*   [x] Integration tests are written and pass, verifying data persistence and API interactions.
*   [x] All Gherkin acceptance criteria scenarios are automated and pass in the CI/CD pipeline.
*   [x] API documentation (e.g., OpenAPI/Swagger) is updated to reflect new fields and validation rules.
*   [x] Database schema changes are applied and verified in all relevant environments (development, staging, production).
*   [x] User Interface (UI) elements for Date of Birth and Occupation fields are implemented and tested for usability and responsiveness.
*   [x] Error messages for mandatory field validation and invalid data types are clear and user-friendly.
*   [x] Performance impact of new fields (e.g., database queries) is assessed and optimized if necessary.
*   [x] Security considerations (e.g., data encryption for sensitive info like DoB, input sanitization) have been addressed.
*   [x] Changes are deployed to a staging environment and validated by QA/Product Owner.
*   [x] Relevant documentation (e.g., administrator guide, data dictionary) is updated.

---

## Pre-requisites / Checklist

*   [ ] User Story and all Acceptance Criteria are reviewed and fully understood by the development team.
*   [ ] UI/UX mockups for the new 'Date of Birth' (including type of input, e.g., date picker) and 'Occupation' fields on user creation/edit forms are available and approved.
*   [ ] Database schema changes (column names, data types, nullability, constraints) for 'date_of_birth' and 'occupation' are clearly defined and approved.
*   [ ] Backend API contract (request/response bodies) for user creation, update, and retrieval endpoints, including the new fields and their validation rules, is specified.
*   [ ] Exact error message strings for mandatory field validation and invalid date format are agreed upon.
*   [ ] Any specific date format (e.g., YYYY-MM-DD) for 'Date of Birth' is confirmed and documented.
*   [ ] Security implications for storing Date of Birth (e.g., data sensitivity, encryption requirements) are understood and initial approach defined.

---

**Suggested Labels**: `feature`, `backend`, `frontend`, `database`, `validation`, `user-management`